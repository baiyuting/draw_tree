<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="vue.js" type="text/javascript"></script>
</head>

<body>
<div style="width: 100%;height: 800px;background-color: aqua" id="app-4">

    <svg xmlns="http://www.w3.org/2000/svg" version="1.1"
         style="width: 100%;height: 100%;position: absolute;top: 0px;left: 0px">
        <!--        <line x1="120" y1="225" x2="220" y2="155" style="stroke:rgb(255,0,0);stroke-width:2"/>-->
        <!--        <line x1="120" y1="225" x2="220" y2="225" style="stroke:rgb(255,0,0);stroke-width:2"/>-->
        <!--        <line x1="120" y1="225" x2="220" y2="295" style="stroke:rgb(255,0,0);stroke-width:2"/>-->
        <line v-for="l in line" :x1="l.x1" :y1="l.y1" :x2="l.x2" :y2="l.y2" style="stroke:rgb(255,0,0);stroke-width:2"/>
    </svg>

    <div v-for="(d,index) in div"
         :style="{'width':d.width, 'height':d.height, 'position':'absolute', 'left':d.left+'px', 'top':d.top+'px', 'background-color':d.background_color, 'display':d.display}">
        {{ index }}
        <img v-if="d.expand" v-on:click="collapse(index,div)" src="减号.png"
             style="width: 20px;height: 20px;background-color: antiquewhite;top: 15px;left: 80px;position: absolute;">
    </div>
    <!--    <div style="width: 100px;height: 50px;position: absolute;background-color: blue;top: 200px;left: 20px;"></div>-->
    <!--    <div style="width: 100px;height: 50px;position: absolute;background-color: blue;top: 130px;left: 220px;"></div>-->
    <!--    <div style="width: 100px;height: 50px;position: absolute;background-color: blue;top: 200px;left: 220px;"></div>-->
    <!--    <div style="width: 100px;height: 50px;position: absolute;background-color: blue;top: 270px;left: 220px;"></div>-->
</div>


<script>
    /**
     * 隐藏该节点的孩子节点
     * @param node_name
     * @param div
     */
    function hide_children(node_name, div) {
        var queue = []
        queue = queue.concat(div[node_name].children)
        while (queue.length !== 0) {
            name = queue.shift()
            console.log("隐藏" + name)
            div[name].display = "none"
            queue = queue.concat(div[name].children)
        }
    }

    /**
     * 重新绘制 方块
     *
     * 遍历树
     *  x: layer * 100 + root.x
     *  y:
     * @param div
     * @param name 节点名称
     * @param last_leaf
     * @param init_top
     * @param init_left
     */
    function repaint_div(div, name, last_leaf, init_top, init_left) {
        // x 轴坐标确定
        div[name].left = div[name].layer * 200 + init_left

        if (!last_leaf && div[name].children.length === 0) {// 如果该节点没有上一个叶子节点 并且 没有孩子节点 此时在 树的最顶端
            div[name].top = init_top
            return name // 返回给调用方新的上个叶子节点
        }
        if (last_leaf != null && div[name].children.length === 0) { // 如果是叶子节点 并且 有上一个叶子节点
            div[name].top = div[last_leaf].top + 50 + 20 // 确定高度=上一个叶子节点高度+50+20
            return name
        }
        if (div[name].children.length !== 0) { // 如果有孩子节点
            let top_value = 0;
            let new_last_leaf = last_leaf
            for (let i = 0; i < div[name].children.length; i++) {
                let child = div[name].children[i]
                new_last_leaf = repaint_div(div, child, new_last_leaf, init_top, init_left) // 采用
                top_value += div[child].top
            }
            div[name].top = top_value / div[name].children.length
            return new_last_leaf
        }

    }

    var app4 = new Vue({
        el: '#app-4',
        methods: {
            /**
             *
             * @param index 那个div执行折叠操作 比如 div0
             * @param div 整个 div 块
             */
            collapse: function (index, div) {
                // 执行折叠操作
                //1、隐藏 该节点的子节点
                hide_children(index, div)

                // console.log(div)

                //2. 重新计算节点位置
                repaint_div(div, "div0", null, 0, 0)

                console.log(div)

                //3. 重新绘制线条
                // app4.$data['line']=[]
                // 图形变成加号
            }
        },

        data: {
            div: {
                "div0": {
                    // div 宽、高、x、y、背景色
                    width: "100px",
                    height: "50px",
                    left: "20",
                    top: "240",
                    background_color: "green",

                    //div 孩子节点
                    children: ["div1", "div2", "div3"],

                    //所在层数
                    layer: 0,

                    //是否展开
                    expand: true,

                    //是否隐藏
                    display: ""
                },
                "div1": {
                    width: "100px",
                    height: "50px",
                    left: "220",
                    top: "100",
                    background_color: "red",
                    children: [],
                    layer: 1,
                    //是否展开
                    expand: false,
                    //是否隐藏
                    display: ""
                },
                "div2": {
                    width: "100px",
                    height: "50px",
                    left: "220",
                    top: "240",
                    background_color: "blue",
                    children: ["div4", "div5"],
                    layer: 1,
                    //是否展开
                    expand: true,
                    //是否隐藏
                    display: ""
                },
                "div3": {
                    width: "100px",
                    height: "50px",
                    left: "220",
                    top: "380",
                    background_color: "red",
                    children: [],
                    layer: 1,
                    //是否展开
                    expand: false,
                    //是否隐藏
                    display: ""
                },
                "div4": {
                    width: "100px",
                    height: "50px",
                    left: "420",
                    top: "170",
                    background_color: "red",
                    children: [],
                    layer: 2,
                    //是否展开
                    expand: false,
                    //是否隐藏
                    display: ""
                },
                "div5": {
                    width: "100px",
                    height: "50px",
                    left: "420",
                    top: "310",
                    background_color: "red",
                    children: [],
                    layer: 2,
                    //是否展开
                    expand: false,
                    //是否隐藏
                    display: ""
                }
            },
            line: [
                {
                    "x1": "120px",
                    "y1": "265px",
                    "x2": "220px",
                    "y2": "125px"
                }, {
                    "x1": "120px",
                    "y1": "265px",
                    "x2": "220px",
                    "y2": "265px"
                }, {
                    "x1": "120px",
                    "y1": "265px",
                    "x2": "220px",
                    "y2": "405px"
                }, {
                    "x1": "320px",
                    "y1": "265px",
                    "x2": "420px",
                    "y2": "195px"
                }, {
                    "x1": "320px",
                    "y1": "265px",
                    "x2": "420px",
                    "y2": "335px"
                }
            ]
        }
    })
</script>
</body>
</html>